USE MASTER
GO
IF DB_ID('QLKS') IS NOT NULL
	DROP DATABASE QLKS
GO
CREATE DATABASE QLKS
GO
USE QLKS
GO

CREATE TABLE KHACHHANG(
MAKH  INT PRIMARY KEY 
)

CREATE TABLE KHACHHANGCANHAN(
MAKHCN INT PRIMARY KEY ,
TENKHCN NVARCHAR(50),
CMND VARCHAR(20),
SDT VARCHAR(20),
DIACHI NVARCHAR(100),
MADOAN INT 
)

CREATE TABLE DOANKHACH(
MADKH INT PRIMARY KEY ,
TENDKH NVARCHAR(50)
)

CREATE TABLE DONVILUHANH(
MADV INT IDENTITY(1,1) PRIMARY KEY,
TENDV NVARCHAR(50),
SDTDV INT,
EMAILDV NVARCHAR(50)
)

CREATE TABLE NHANVIEN(
MANV INT PRIMARY KEY,
LOAINV NVARCHAR(50),
SDT NVARCHAR(50),
EMAIL NVARCHAR(50),
DIACHI NVARCHAR(50),
LUONG INT
)
CREATE TABLE DATPHONG(
MADP INT IDENTITY(1,1) PRIMARY KEY,
MANV INT,
NGAYNHAN DATE,
NGAYTRA DATE,
NGAYDATPHONG DATE,
LOAIPHONG NVARCHAR(50),
TRANGTHAI NVARCHAR(50),
MAKH INT,
MADVLH INT
)

CREATE TABLE SANPHAMDICHVU(
MASP INT PRIMARY KEY,
TENSP NVARCHAR(50),
LOAISP NVARCHAR(50),
GIASP INT,
DONVI NVARCHAR(50),
THONGTINSP NVARCHAR(50)
)

CREATE TABLE HOADON(
MAHD INT IDENTITY(1,1) PRIMARY KEY,
NGAY DATE,
GIO TIME,
TRANGTHAI NVARCHAR(50),
TONGTIEN FLOAT,
PTTHANHTOAN NVARCHAR(50),
MANV INT,
MALSDP INT
)

CREATE TABLE HOADONTRUCTUYEN(
MAHD INT PRIMARY KEY,
MAGIAODICH INT,
LOAITHE NVARCHAR(50),
SOTHE VARCHAR(50),
NGAYHETHAN DATE,
MABAOMAT INT,
TENCHUTHE NVARCHAR(50)
)

CREATE TABLE PHIEUDANGKYTOUR(
MAPHIEUDK NVARCHAR PRIMARY KEY,
THOIGIANKHOIHANH NVARCHAR,
NGAYDK NVARCHAR,
SONGUOITHAMGIA NVARCHAR,
DICHVUDUADON NVARCHAR,
YEUCAUDACBIET NVARCHAR,
KETQUADANGKY NVARCHAR,
MATOUR NVARCHAR
)

CREATE TABLE TOUR(
MATOUR NVARCHAR PRIMARY KEY,
THONGTINSP NVARCHAR,
LOAISP NVARCHAR,
GIASP NVARCHAR,
MADVLH INT
)
CREATE TABLE KHACHHANGTHAMGIATOUR(
MAKH INT,
MAPHIEUDK NVARCHAR
PRIMARY KEY (MAKH,MAPHIEUDK)
)
CREATE TABLE PHONG(
MAPHONG INT PRIMARY KEY,
LOAIPHONG NVARCHAR(50),
TRANGTHAIPHONG NVARCHAR(50)
)
CREATE TABLE THONGTINSUDUNGDICHVU(
MATT INT PRIMARY KEY,
MASP INT,
MALSDP INT,
MAHD INT,
STT	INT,
GIATHANH FLOAT,
SOLUONG INT
)

CREATE TABLE LICHSUDUNGPHONG(
MALSDP INT IDENTITY(1,1) PRIMARY KEY,
MADP INT,
MAPHONG INT,
STT INT,
NGAYNHAN DATE,
NGAYTRA DATE,
)

CREATE TABLE LICHSUDUNGDICHVU(
MAPHIEUDK INT PRIMARY KEY,
THOIGIANSUDUNG TIME,
NGAYDANGKY DATE,
YEUCAUDACBIET NVARCHAR(50),
MATTSDDV INT,
)
ALTER TABLE KHACHHANGCANHAN
ADD CONSTRAINT FK_KHCN_KH
	FOREIGN KEY (MAKHCN)
	REFERENCES KHACHHANG,
    CONSTRAINT FK_KHCN_DK
	FOREIGN KEY (MADOAN)
	REFERENCES DOANKHACH

ALTER TABLE DOANKHACH
ADD CONSTRAINT FK_DK_KH
	FOREIGN KEY (MADKH)
	REFERENCES KHACHHANG

ALTER TABLE DATPHONG
ADD CONSTRAINT FK_DP_KH
	FOREIGN KEY (MAKH)
	REFERENCES KHACHHANG,
	CONSTRAINT FK_DP_NV
	FOREIGN KEY (MANV)
	REFERENCES NHANVIEN,
	CONSTRAINT FK_DVLH_NV
	FOREIGN KEY (MADVLH)
	REFERENCES DONVILUHANH

ALTER TABLE THONGTINSUDUNGDICHVU
ADD CONSTRAINT FK_TT_SP
	FOREIGN KEY (MASP)
	REFERENCES SANPHAMDICHVU,
	CONSTRAINT FK_TT_LSDP
	FOREIGN KEY (MALSDP)
	REFERENCES LICHSUDUNGPHONG,
	CONSTRAINT FK_TT_HD
	FOREIGN KEY (MAHD)
	REFERENCES HOADON
ALTER TABLE LICHSUDUNGDICHVU
ADD CONSTRAINT FK_LICH_DV
	FOREIGN KEY (MATTSDDV)
	REFERENCES THONGTINSUDUNGDICHVU
ALTER TABLE LICHSUDUNGPHONG
ADD CONSTRAINT FK_LS_DP
	FOREIGN KEY( MADP)
	REFERENCES DATPHONG,
	CONSTRAINT FK_SL_P
	FOREIGN KEY (MAPHONG)
	REFERENCES PHONG
ALTER TABLE HOADON 
ADD CONSTRAINT FK_HD_NV
	FOREIGN KEY (MANV)
	REFERENCES NHANVIEN,
	CONSTRAINT FK_HD_LSDP
	FOREIGN KEY (MALSDP)
	REFERENCES LICHSUDUNGPHONG
ALTER TABLE HOADONTRUCTUYEN
ADD CONSTRAINT FK_HDTT_HD
	FOREIGN KEY (MAHD)
	REFERENCES HOADON
ALTER TABLE PHIEUDANGKYTOUR
ADD CONSTRAINT FK_PDKT_T
	FOREIGN KEY (MATOUR)
	REFERENCES TOUR
ALTER TABLE KHACHHANGTHAMGIATOUR
ADD CONSTRAINT FK_KHTGT_KH
	FOREIGN KEY (MAKH)
	REFERENCES KHACHHANGCANHAN,
	CONSTRAINT FK_KHTGT_PDKT
	FOREIGN KEY (MAPHIEUDK)
	REFERENCES PHIEUDANGKYTOUR
ALTER TABLE TOUR
ADD CONSTRAINT FK_T_DVLH
	FOREIGN KEY (MADVLH)
	REFERENCES DONVILUHANH

INSERT INTO KHACHHANG (MAKH) 
VALUES 
    (1),
    (2),
    (3),
    (4),
    (5),
    (6),
    (7),
    (8),
    (9),
    (10),
	(11),
	(12),
	(13),
	(14),
	(15),
	(16),
	(17),
	(18),
	(19),
	(20),
	(21),
	(22),
	(23),
	(24),
	(25);

INSERT INTO DOANKHACH (MADKH, TENDKH) VALUES (11, 'Đoàn khách A');
INSERT INTO DOANKHACH (MADKH, TENDKH) VALUES (12, 'Đoàn khách B');
INSERT INTO DOANKHACH (MADKH, TENDKH) VALUES (13, 'Đoàn khách C');
INSERT INTO DOANKHACH (MADKH, TENDKH) VALUES (14, 'Đoàn khách D');
INSERT INTO DOANKHACH (MADKH, TENDKH) VALUES (15, 'Đoàn khách E');

INSERT INTO DONVILUHANH (TENDV, SDTDV, EMAILDV) VALUES (N'Đơn vị lữ hành A', 123456789, 'donviluhanhA@gmail.com');
INSERT INTO DONVILUHANH (TENDV, SDTDV, EMAILDV) VALUES (N'Đơn vị lữ hành B', 234567890, 'donviluhanhB@gmail.com');
INSERT INTO DONVILUHANH (TENDV, SDTDV, EMAILDV) VALUES (N'Đơn vị lữ hành C', 345678901, 'donviluhanhC@gmail.com');
INSERT INTO DONVILUHANH (TENDV, SDTDV, EMAILDV) VALUES (N'Đơn vị lữ hành D', 456789012, 'donviluhanhD@gmail.com');
INSERT INTO DONVILUHANH (TENDV, SDTDV, EMAILDV) VALUES (N'Đơn vị lữ hành E', 567890123, 'donviluhanhE@gmail.com');

INSERT INTO KHACHHANGCANHAN (MAKHCN, TENKHCN, CMND, SDT, DIACHI, MADOAN) 
VALUES 
    (1, 'John Doe', '123456789', '1234567890', '123 Main St', 14),
    (2, 'Jane Smith', '987654321', '9876543210', '456 Oak Ave', null),
    (3, 'Bob Johnson', '456123789', '4561237890', '789 Elm St', 14),
    (4, 'Mary Davis', '789123456', '7891234560', '321 Maple Ave', null),
    (5, 'Tom Wilson', '321987654', '3219876540', '654 Pine St', 15),
    (6, 'Sara Lee', '654789123', '6547891230', '987 Cedar Ave', null),
    (7, 'Mike Brown', '789456123', '7894561230', '159 Spruce St', null),
    (8, 'Lisa Chen', '456789123', '4567891230', '357 Birch Ave', 11),
    (9, 'David Lee', '852369741', '8523697410', '753 Oak St', null),
    (10, 'Karen Smith','369852147', '3698521470', '159 Maple Ave', null),
	(11, 'Amy Lee', '789654123', '7896541230', '258 Elm St', null),
    (12, 'Mark Johnson', '456789321', '4567893210', '753 Cedar Ave', null),
    (13, 'Nancy Davis', '987321456', '9873214560', '456 Pine St', null),
    (14, 'Tim Wilson', '654123987', '6541239870', '951 Spruce St', null),
    (15, 'Emily Brown', '321456789', '3214567890', '357 Maple Ave', null),
    (16, 'Chris Chen', '852741369', '8527413690', '159 Oak St', 12),
    (17, 'Erica Lee', '369147852', '3691478520', '753 Birch Ave', null),
    (18, 'Sam Smith', '159753468', '1597534680', '456 Cedar St', null),
    (19, 'Linda Johnson', '753159864', '7531598640', '951 Pine Ave', null),
    (20, 'Mike Davis', '456258369', '4562583690', '357 Spruce St', null),
    (21, 'Susan Wilson', '951753624', '9517536240', '159 Maple Ave', null),
    (22, 'Greg Brown', '852369147', '8523691470', '753 Oak St', 11),
    (23, 'Anna Chen', '369852741', '3698527410', '456 Birch Ave', 11),
    (24, 'Peter Lee', '159753486', '1597534860', '951 Cedar St', null),
    (25, 'Rachel Smith', '753159842', '7531598420', '357 Pine Ave', null);

INSERT INTO SANPHAMDICHVU (MASP, TENSP, LOAISP, GIASP, DONVI, THONGTINSP) 
VALUES 
(1, N'Phòng đơn', N'Đặt phòng', N'300000', N'Đêm lưu trú', N'Phòng đơn tối đa 3 người'),
(2, N'Phòng đôi', N'Đặt phòng', N'500000', N'Đêm lưu trú', N'Phòng đôi tối đa 6 người');

INSERT INTO NHANVIEN (MANV, LOAINV, SDT, EMAIL, DIACHI, LUONG)
VALUES
(1, N'Tiếp Tân', '0901234567', 'quanly@khachsan.com', N'123 Đường ABC, Quận 1, TP. HCM', '10000000');

INSERT INTO PHONG (MAPHONG, LOAIPHONG, TRANGTHAIPHONG) VALUES
(1, N'Phòng Đơn', N'Trống'),
(2, N'Phòng Đôi', N'Đầy'),
(3, N'Phòng Đơn', N'Trống'),
(4, N'Phòng Đôi', N'Đầy'),
(5, N'Phòng Đơn', N'Trống'),
(6, N'Phòng Đôi', N'Đầy'),
(7, N'Phòng Đơn', N'Trống'),
(8, N'Phòng Đôi', N'Đầy'),
(9, N'Phòng Đơn', N'Trống'),
(10, N'Phòng Đôi', N'Trống'),
(11, N'Phòng Đơn', N'Trống'),
(12, N'Phòng Đôi', N'Đầy'),
(13, N'Phòng Đơn', N'Trống'),
(14, N'Phòng Đôi', N'Trống'),
(15, N'Phòng Đơn', N'Trống'),
(16, N'Phòng Đôi', N'Đầy'),
(17, N'Phòng Đơn', N'Trống'),
(18, N'Phòng Đôi', N'Đầy'),
(19, N'Phòng Đơn', N'Trống'),
(20, N'Phòng Đôi', N'Đầy'),
(21, N'Phòng Đơn', N'Trống'),
(22, N'Phòng Đôi', N'Trống'),
(23, N'Phòng Đơn', N'Trống'),
(24, N'Phòng Đôi', N'Đầy'),
(25, N'Phòng Đơn', N'Trống'),
(26, N'Phòng Đôi', N'Đầy'),
(27, N'Phòng Đơn', N'Trống'),
(28, N'Phòng Đôi', N'Đầy'),
(29, N'Phòng Đơn', N'Trống'),
(30, N'Phòng Đôi', N'Đầy'),
(31, N'Phòng Đơn', N'Trống'),
(32, N'Phòng Đôi', N'Trống'),
(33, N'Phòng Đơn', N'Trống'),
(34, N'Phòng Đôi', N'Đầy'),
(35, N'Phòng Đơn', N'Trống'),
(36, N'Phòng Đôi', N'Đầy'),
(37, N'Phòng Đơn', N'Trống'),
(38, N'Phòng Đôi', N'Đầy'),
(39, N'Phòng Đơn', N'Trống'),
(40, N'Phòng Đôi', N'Đầy'),
(41, N'Phòng Đơn', N'Trống'),
(42, N'Phòng Đôi', N'Đầy'),
(43, N'Phòng Đơn', N'Trống'),
(44, N'Phòng Đôi', N'Đầy'),
(45, N'Phòng Đôi', N'Đầy'),
(46, N'Phòng Đôi', N'Trống'),
(47, N'Phòng Đôi', N'Đầy'),
(48, N'Phòng Đôi', N'Đầy'),
(49, N'Phòng Đôi', N'Trống'),
(50, N'Phòng Đôi', N'Đầy');

INSERT INTO DATPHONG (MANV, NGAYNHAN, NGAYTRA, NGAYDATPHONG, LOAIPHONG, TRANGTHAI, MAKH, MADVLH)
VALUES
(1, '2023-05-01', '2023-05-03', '2023-01-01', N'Phòng đơn', N'Check in', 1, NULL),
(1, '2023-05-10', '2023-05-12', '2023-02-10', N'Phòng đôi', N'Đặt phòng', 2, NULL),
(1, '2023-05-15', '2023-05-18', '2023-03-14', N'Phòng đơn', N'Đặt phòng', 3, NULL),
(1, '2023-05-20', '2023-05-25', '2023-04-19', N'Phòng đôi', N'Check out', 4, NULL),
(1, '2023-05-12', '2023-05-14', '2023-05-11', N'Phòng đơn', N'Check out', 5, NULL);

INSERT INTO LICHSUDUNGPHONG (MADP, MAPHONG, STT, NGAYNHAN, NGAYTRA)
VALUES
(1, 1, 1, '2023-05-01', '2023-05-03'),
(2, 2, 2, '2023-05-10', '2023-05-12'),
(3, 3, 1, '2023-05-15', '2023-05-18'),
(4, 4, 2, '2023-05-20', '2023-05-25'),
(5, 5, 1, '2023-05-12', '2023-05-14');

INSERT INTO HOADON (NGAY, GIO, TRANGTHAI, TONGTIEN, PTTHANHTOAN, MANV, MALSDP)
VALUES ('2023-05-10', '13:45:00', N'Thành công', 1000000, N'Thẻ', 1, null);

INSERT INTO HOADONTRUCTUYEN (MAHD, MAGIAODICH, LOAITHE, SOTHE, NGAYHETHAN, MABAOMAT, TENCHUTHE)
VALUES (1, 123456, 'Visa', 1234567, '2024-06-30', 123, 'John Smith');

INSERT INTO DATPHONG (MANV, NGAYNHAN, NGAYTRA, NGAYDATPHONG, LOAIPHONG, TRANGTHAI, MAKH, MADVLH)
VALUES
(1, '2023-05-01', '2023-05-03', '2023-01-01', N'Phòng đơn', N'Check in', 1, NULL);

INSERT INTO LICHSUDUNGPHONG (MADP, MAPHONG, STT, NGAYNHAN, NGAYTRA)
VALUES
(2, 1, 1, '2023-05-05', '2023-06-03');

/*
SELECT MAPHONG, LOAIPHONG, TRANGTHAIPHONG, GIASP 
FROM PHONG, SANPHAMDICHVU 
WHERE PHONG.LOAIPHONG = SANPHAMDICHVU.TENSP;*/

/*
SELECT MAPHONG, LOAIPHONG, TRANGTHAIPHONG, GIASP 
FROM PHONG, SANPHAMDICHVU
WHERE PHONG.LOAIPHONG = SANPHAMDICHVU.TENSP
AND LOAIPHONG = N'Phòng đơn'*/

/*SELECT MAPHONG, LOAIPHONG, TRANGTHAIPHONG, GIASP 
FROM PHONG, SANPHAMDICHVU
WHERE PHONG.LOAIPHONG = SANPHAMDICHVU.TENSP
AND LOAIPHONG = N'Phòng đơn'
AND PHONG.MAPHONG NOT IN (SELECT LSDP.MAPHONG 
						  FROM LICHSUDUNGPHONG LSDP 
						  WHERE '2023-05-12' BETWEEN NGAYNHAN AND NGAYTRA);*/


SELECT * FROM KHACHHANGCANHAN;